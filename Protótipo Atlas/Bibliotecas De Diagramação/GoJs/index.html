<!DOCTYPE html>
<!--Using GoJs to show FMs
Author: Luciano Marchezan
Date: 2017
-->
<html>
<head>
<title>GoJs</title>
<meta name="description" content="Links can connect with Links by using label Nodes on Links." />
<meta charset="UTF-8">
<script src="go.js"></script>
<script id="code">
  function init() {
   
    var $ = go.GraphObject.make;
    myDiagram =
      $(go.Diagram, "myDiagramDiv",  // create a Diagram for the DIV HTML element
        {
          initialContentAlignment: go.Spot.Center,
          "LinkDrawn": maybeChangeLinkCategory,     // these two DiagramEvents call a function that is defined below
          "LinkRelinked": maybeChangeLinkCategory,  
          "undoManager.isEnabled": true,
		   "diagram.isReadOnly" : true,
		  layout: $(go.TreeLayout, // specify a Diagram.layout that arranges trees
                { angle: 90, layerSpacing: 80 })
        });
		
    myDiagram.addDiagramListener("Modified", function(e) {
      var button = document.getElementById("SaveButton");
      if (button) button.disabled = !myDiagram.isModified;
      var idx = document.title.indexOf("*");
      if (myDiagram.isModified) {
        if (idx < 0) document.title += "*";
      } else {
        if (idx >= 0) document.title = document.title.substr(0, idx);
      }
    });
    // the regular node template
    myDiagram.nodeTemplate =
      $("Node", "Auto",
        { locationSpot: go.Spot.Center,
          layerName: "Background" },  // always have regular nodes behind Links
        new go.Binding("location", "loc", go.Point.parse).makeTwoWay(go.Point.stringify),
        $("Shape", "Rectangle",
          { fill: "white", stroke: "black",
            portId: "", cursor: "pointer" },
          new go.Binding("fill", "color")),
        $("TextBlock",
          { margin: 8 },  
          new go.Binding("text", "key"))  
      );
	  
    // This is the template for a label node on a link: just an Ellipse, but with 0 size what makes it invisible.
    myDiagram.nodeTemplateMap.add("LinkLabel",
      $("Node",
        { selectable: false, avoidable: false,
          layerName: "Foreground" },  // always have link label nodes in front of Links
        $("Shape", "Ellipse",
          { width: 0, height: 0, stroke: null,
            portId: "", fromLinkable: true, toLinkable: true, cursor: "pointer" })
      ));
	  
	  
	
    // the regular link template, mandatory features
    myDiagram.linkTemplate =
      $("Link",
		
        { relinkableFrom: true, relinkableTo: true, toShortLength: 2 },
        $("Shape", { stroke: "#000", strokeWidth: 2 })
      );
	  
    // template to link links
    myDiagram.linkTemplateMap.add("linkToLink",
      $("Link", { 
	  curve: go.Link.Bezier,curviness: 3 }, 
        { relinkableFrom: true, relinkableTo: true },
        $("Shape", { stroke: "#000", strokeWidth: 2 })
		));
	  
	  // template for optional features
	  myDiagram.linkTemplateMap.add("optional",
      $("Link",
        { relinkableFrom: true, relinkableTo: true },
        $("Shape", { stroke: "#000", strokeWidth: 2 }),
		$("Shape", { fill: "#fff", stroke: "#000", toArrow: "Circle" })
      ));
	  
	
	  
	  
    // GraphLinksModel support for link label nodes requires specifying two properties.
    myDiagram.model =
      $(go.GraphLinksModel,
        { linkLabelKeysProperty: "labelKeys" });
    myDiagram.toolManager.linkingTool.archetypeLabelNodeData =
      { category: "LinkLabel" };
    function maybeChangeLinkCategory(e) {
      var link = e.subject;
      var linktolink = (link.fromNode.isLinkLabel || link.toNode.isLinkLabel);
      e.diagram.model.setCategoryForLinkData(link.data, (linktolink ? "linkToLink" : ""));
    }
    load();
  }
  // Show the diagram's model in JSON format
  function save() {
    document.getElementById("mySavedModel").value = myDiagram.model.toJson();
    myDiagram.isModified = false;
  }
  function load() {
    myDiagram.model = go.Model.fromJson(document.getElementById("mySavedModel").value);
  }
  
</script>
</head>
<body onload="init()">
  <div id="sample">
    <div id="myDiagramDiv" style="border: solid 1px black; width:100%; height:400px;"></div>
    <p>
      This is only a sample. The main objective is to test de capability of GoJs.
    </p>
    
    </p>
    <div>
      <div>
        <button id="SaveButton" onclick="save()">Save</button>
        <button onclick="load()">Load</button>
        Diagram.model saved in JSON format:<br />
      </div>
      <textarea id="mySavedModel" style="width:100%;height:400px">
	  
	  
{ "class": "go.GraphLinksModel",
  "linkLabelKeysProperty": "labelKeys",
  "nodeDataArray": [ 
{"key":"Root", "category":"mandatory"},
{"key":"F1", "category":"mandatory"},
{"key":"F2", "category":"alternative"},
{"key":"F3", "category":"alternative"},
{"key":"F4", "category":"optional"},
{"key":"F5", "category":"optional"},
{"key":"F12", "category":"optional"},
{"key":"F13", "category":"alternative"},
{"key":"F14", "category":"alternative"},
{"key":"F15", "category":"alternative"},
{"key":"Root-F1", "category":"LinkLabel"},
{"key":"Root-F5", "category":"LinkLabel"},
{"key":"Root-F12", "category":"LinkLabel"},
{"key":"F1-F2", "category":"LinkLabel"},
{"key":"F1-F3", "category":"LinkLabel"},
{"key":"F1-F4", "category":"LinkLabel"},
{"key":"F12-F13", "category":"LinkLabel"},
{"key":"F12-F14", "category":"LinkLabel"},
{"key":"F12-F15", "category":"LinkLabel"},
{"key":"Alt1", "category":"LinkLabel"},
{"key":"Alt2", "category":"LinkLabel"}
 ],
  "linkDataArray": [ 
{"from":"Root", "to":"F1", "labelKeys":[ "Root-F1" ]},
{"from":"Root", "to":"F5", "labelKeys":[ "Root-F5" ],"category":"optional"},
{"from":"Root", "to":"F12", "labelKeys":[ "Root-F12" ],"category":"optional"},
{"from":"F1", "to":"F2", "labelKeys":[ "F1-F2" ]},
{"from":"F1", "to":"F3", "labelKeys":[ "F1-F3" ]},
{"from":"F1", "to":"F4", "labelKeys":[ "F1-F4" ],"category":"optional"},
{"from":"F1-F3", "to":"F1-F2", "labelKeys":[ "Alt1" ], "category":"linkToLink"},
{"from":"F12", "to":"F13", "labelKeys":[ "F12-F13" ]},
{"from":"F12", "to":"F14", "labelKeys":[ "F12-F14" ]},
{"from":"F12", "to":"F15", "labelKeys":[ "F12-F15" ]},
{"from":"F12-F15", "to":"F12-F13", "labelKeys":[ "Alt2" ], "category":"linkToLink"}
 ]}
      
	        </textarea>
    </div>
  </div>
</body>
</html>